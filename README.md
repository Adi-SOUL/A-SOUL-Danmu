# ASDM：开源的直播间弹幕获取以及检索软件

开场介绍我摆了，和标题没什么区别。

## 1 使用方法

### 1.1 弹幕记录

使用起来很简单，双击**main.exe**启动即可，在主界面按照要求输入信息点击开始即可。

记录的格式类似于：

```
记录时间：：粉丝牌等级-粉丝牌名称：：用户名-uid：：弹幕内容
```

（当选择“记录粉丝牌信息“但是当前发言用户未佩戴粉丝牌的，使用“0-0”标识“粉丝牌等级-粉丝牌名称”。）文件会被保存在你选择的文件里 。

目前发布的版本中，会进行开播检测，即无法录制非开播直播间。同时，当直播间结束直播时也会自动停止录制。

为什么？

主要是方便点击开始后就不用继续操作。后续版本会支持随意录制吗？可能会，并且会标注当前弹幕是否在开播时间发出。

### 1.2  弹幕内容检索

在主界面的左上角选择*工具->弹幕搜索*即可进入功能。首先需要选择对应的录播日志（如果要使用其他录播的文件，请保证每一条弹幕的记录方式如1.1节），然后按照格式输入制定搜索语句进行搜索，目前搜索格式为：

```
keyword：target_1[；；target_2]
```

也就是使用全角冒号分割关键词和搜索目标，使用两个全角分号分割多个搜索目标（如有）。目前支持的keyword和对应功能列举如下：

#### danmu

使用该关键词检索弹幕内容，该关键字会将target与弹幕内容按照KMP算法进行匹配，举例来说：当使用此关键词搜索“快快快”时，“快快快”，“快快快快”会被匹配，但是“快快，快”不会。

#### danmuF

使用方法同**danmu**，但是只有target与弹幕内容完全相同的时候才会匹配。

**请注意，如果没有特殊说明，包含F的关键词和原关键词之间的关系同danmuF与danmu之间的关系，并且如果没有特殊说明，下列关键词均有对应的F版本。**

#### danmuC

检索弹幕内容并且进行统计，例如：当你使用命令

```
danmuC：勇敢牛牛
```

时，会统计：

- 一共有多少条弹幕包含关键词“勇敢牛牛”，并将这些弹幕的信息记录下来

- 有哪些人发送了这些弹幕，并且对这些发送者的发送次数进行排行

#### danmuFC

**请注意，如果没有特殊说明，同时包含C和F的指令中，C和F的排列顺序应当如此。如果没有特殊说明，下列关键词均有对应的C版本 。**

#### name

使用该关键词检索用户名称 ，即寻找某一用户在直播间的发言。由于名称的特殊性，**推荐使用nameF而非name**，避免查询到无关人士。

更加推荐的用户检索方式详见**id**系列关键词。

#### nameF

略

#### nameC

统计相关用户名的用户的发言次数，并记录发言内容 。同样的，**由于不同的用户名并不会分开计次，所以强烈推荐使用nameFC而非nameC。该关键词只是出于完整性而被保留下来。**

同样的，更加强烈推荐的用户检索方式见**id**系列关键词。

#### id

通过用户的uid检索发言内容。请注意，**id与idF指令完全相同，均是完全匹配。**

#### idC

统计内容同nameC，但是比nameC更加准确。同样的，**idC与idFC没有区别。**

#### fans

通过粉丝牌信息进行检索，目前fans系列关键词支持的target有两种：

- 粉丝牌等级-粉丝牌名称

- 粉丝牌名称

当使用fans关键词时，“**2-贝**“会搜索到所有粉丝牌等级里拥有“2”的并且粉丝牌名字带有“贝”的发言信息；“**贝**“会搜索到所有粉丝牌名字里带有“**贝**”的发言信息。**你无法使用粉丝牌等级进行搜索。**

0-0标识没有粉丝牌信息。

#### fansF

当使用该关键词时，你无法只匹配粉丝牌名字而不匹配粉丝牌等级。例如“2-贝极星”只能找到2级的贝极星。

#### fansC

略

#### fansFC

略

#### userC

**该关键词没有对应的F版本**

userC不接收target，但你仍然应该使用“：”，就像这样

```
userC：
```

该关键词会统计该场直播中每个用户的发言次数，并进行排序。

#### totalC

**该关键词没有对应的F版本**

该关键词只接收两种target：T和F，用于表示是否在控制台显示搜索结果。

该关键词统计内容为：

- 按照第一次发言时间列出用户名--uid

- 统计总共的发言人次

- 给出当前录制文件的起止时间

- （额外的）当同一个uid的用户在记录中的名称发生改变时，会给出相应标识（不会参与计数）

#### 包含N的关键词

还需要注意的是，当程序发现相同检索（即对同一份日志文件进行了相同目的的检索）的结果文件已经存在时，将**不会**重新进行搜索，而是会直接输出上次的结果。如果需要重新执行搜索，请在对应的关键词前加上**N**，例如当结果文件已经存在时，重新搜索包含“快快快”的弹幕：

```
Ndanmu：快快快
```

此时原文件也会被覆盖。

### 1.3 检索结果保存

所有结果会保存在main.exe同级目录下的result文件夹下（如果没有的话程序会自己创建）。文件名称为：

```
输入的日志文件名称_关键词_搜索目标.log
```

例如，使用文件“珈乐_12_18.log"，使用命令“danmu：快快快”得到的结果会被保存到：

```
珈乐_12_18_danmu_快快快.log
```


